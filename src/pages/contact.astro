---
import Layout from '../layouts/Layout.astro';
---

<Layout title="Get a Quote | Vantage Point" description="Request a quote for drone aerial data capture. Tell us about your project and get a response within 24 hours. Serving Southern California.">
  <!-- Page Hero -->
  <section class="py-32 pt-40">
    <div class="section-container">
      <div class="text-center">
        <div class="inline-block mb-6">
          <span class="text-xs font-bold tracking-widest text-amber-500">CONTACT US</span>
        </div>
        <h1 class="heading-display mb-6">Let's Get Your Project Started</h1>
        <p class="text-lg text-zinc-300 max-w-2xl mx-auto">
          Tell us about your project and we'll get back to you within 24 hours with a custom quote.
        </p>
      </div>
    </div>
  </section>

  <!-- Two-column layout -->
  <section class="py-20 pb-32">
    <div class="section-container">
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
        <!-- LEFT - Contact Form (2/3 width) -->
        <div class="lg:col-span-2">
          <form
            id="contactForm"
            data-portal-id="YOUR_PORTAL_ID"
            data-form-guid="YOUR_FORM_GUID"
            class="space-y-6"
          >
            <!-- Name Field -->
            <div>
              <label for="name" class="block text-sm uppercase tracking-wider text-zinc-400 mb-2">
                Name <span class="text-amber-500">*</span>
              </label>
              <input
                type="text"
                id="name"
                name="name"
                required
                placeholder="Your full name"
                class="w-full px-4 py-3 bg-zinc-900 border border-zinc-700 text-white placeholder-zinc-500 focus:outline-none focus:border-amber-500 transition-colors"
              />
            </div>

            <!-- Email Field -->
            <div>
              <label for="email" class="block text-sm uppercase tracking-wider text-zinc-400 mb-2">
                Email <span class="text-amber-500">*</span>
              </label>
              <input
                type="email"
                id="email"
                name="email"
                required
                placeholder="your@email.com"
                class="w-full px-4 py-3 bg-zinc-900 border border-zinc-700 text-white placeholder-zinc-500 focus:outline-none focus:border-amber-500 transition-colors"
              />
            </div>

            <!-- Phone Field -->
            <div>
              <label for="phone" class="block text-sm uppercase tracking-wider text-zinc-400 mb-2">
                Phone
              </label>
              <input
                type="tel"
                id="phone"
                name="phone"
                placeholder="(555) 000-0000"
                class="w-full px-4 py-3 bg-zinc-900 border border-zinc-700 text-white placeholder-zinc-500 focus:outline-none focus:border-amber-500 transition-colors"
              />
            </div>

            <!-- Company Field -->
            <div>
              <label for="company" class="block text-sm uppercase tracking-wider text-zinc-400 mb-2">
                Company
              </label>
              <input
                type="text"
                id="company"
                name="company"
                placeholder="Your company name"
                class="w-full px-4 py-3 bg-zinc-900 border border-zinc-700 text-white placeholder-zinc-500 focus:outline-none focus:border-amber-500 transition-colors"
              />
            </div>

            <!-- Project Type Select -->
            <div>
              <label for="projectType" class="block text-sm uppercase tracking-wider text-zinc-400 mb-2">
                Project Type
              </label>
              <select
                id="projectType"
                name="projectType"
                class="w-full px-4 py-3 bg-zinc-900 border border-zinc-700 text-white focus:outline-none focus:border-amber-500 transition-colors cursor-pointer"
              >
                <option value="">Select project type...</option>
                <option value="construction-monitoring">Construction Progress Monitoring</option>
                <option value="solar-assessment">Solar Site Assessment</option>
                <option value="roof-measurement">Roof Measurement & Documentation</option>
                <option value="agricultural">Agricultural Mapping</option>
                <option value="stockpile">Stockpile Volumetrics</option>
                <option value="insurance">Insurance Documentation</option>
                <option value="survey">Survey Data Collection</option>
                <option value="other">Other</option>
              </select>
            </div>

            <!-- Project Location Field -->
            <div>
              <label for="location" class="block text-sm uppercase tracking-wider text-zinc-400 mb-2">
                Project Location <span class="text-amber-500">*</span>
              </label>
              <input
                type="text"
                id="location"
                name="location"
                required
                placeholder="City or region"
                class="w-full px-4 py-3 bg-zinc-900 border border-zinc-700 text-white placeholder-zinc-500 focus:outline-none focus:border-amber-500 transition-colors"
              />
            </div>

            <!-- Timeline Select -->
            <div>
              <label for="timeline" class="block text-sm uppercase tracking-wider text-zinc-400 mb-2">
                Timeline <span class="text-amber-500">*</span>
              </label>
              <select
                id="timeline"
                name="timeline"
                required
                class="w-full px-4 py-3 bg-zinc-900 border border-zinc-700 text-white focus:outline-none focus:border-amber-500 transition-colors cursor-pointer"
              >
                <option value="">When do you need this?</option>
                <option value="asap">ASAP / Within 1 week</option>
                <option value="2-weeks">Within 2 weeks</option>
                <option value="1-month">Within 1 month</option>
                <option value="flexible">Flexible / Ongoing</option>
              </select>
            </div>

            <!-- Budget Range Select -->
            <div>
              <label for="budget" class="block text-sm uppercase tracking-wider text-zinc-400 mb-2">
                Budget Range
              </label>
              <select
                id="budget"
                name="budget"
                class="w-full px-4 py-3 bg-zinc-900 border border-zinc-700 text-white focus:outline-none focus:border-amber-500 transition-colors cursor-pointer"
              >
                <option value="">Select budget range (optional)</option>
                <option value="under-500">Under $500</option>
                <option value="500-1k">$500 - $1,000</option>
                <option value="1k-2.5k">$1,000 - $2,500</option>
                <option value="2.5k-5k">$2,500 - $5,000</option>
                <option value="5k-plus">$5,000+</option>
                <option value="not-sure">Not sure yet</option>
              </select>
            </div>

            <!-- Project Details Textarea -->
            <div>
              <label for="details" class="block text-sm uppercase tracking-wider text-zinc-400 mb-2">
                Project Details
              </label>
              <textarea
                id="details"
                name="details"
                rows="5"
                placeholder="Tell us more about your project, specific requirements, and any deliverables you need..."
                class="w-full px-4 py-3 bg-zinc-900 border border-zinc-700 text-white placeholder-zinc-500 focus:outline-none focus:border-amber-500 transition-colors resize-none"
              ></textarea>
            </div>

            <!-- Submit Button -->
            <div class="pt-4">
              <button
                type="submit"
                class="btn-primary w-full"
                id="submitBtn"
              >
                Submit Request
              </button>
            </div>

            <!-- Success Message (hidden by default) -->
            <div
              id="successMessage"
              class="hidden p-6 bg-green-900/20 border border-green-700 rounded text-green-300 text-center"
            >
              <p class="font-semibold mb-2">Thank you!</p>
              <p>We'll contact you within 24 hours.</p>
            </div>

            <!-- Error Message (hidden by default) -->
            <div
              id="errorMessage"
              class="hidden p-6 bg-red-900/20 border border-red-700 rounded text-red-300 text-center"
            >
              <p class="font-semibold mb-2">Something went wrong</p>
              <p class="mb-4">Please try again or email us directly at <a href="mailto:contact@vantagepoint.com" class="text-amber-400 hover:text-amber-300 underline">contact@vantagepoint.com</a></p>
            </div>
          </form>
        </div>

        <!-- RIGHT - Contact Info (1/3 width) -->
        <div class="lg:col-span-1 space-y-8">
          <!-- Get in Touch Card -->
          <div class="card">
            <h3 class="heading-card mb-6">Get in Touch</h3>
            <div class="space-y-4">
              <div>
                <p class="text-xs uppercase tracking-wider text-zinc-500 mb-1">Location</p>
                <p class="text-white">Southern California</p>
              </div>
              <div>
                <p class="text-xs uppercase tracking-wider text-zinc-500 mb-1">Response Time</p>
                <p class="text-white">Within 24 hours</p>
              </div>
              <div class="pt-4 border-t border-zinc-800">
                <p class="text-xs uppercase tracking-wider text-zinc-500 mb-2">Or email us directly</p>
                <a href="mailto:contact@vantagepoint.com" class="text-amber-500 hover:text-amber-400 font-medium transition-colors">
                  contact@vantagepoint.com
                </a>
              </div>
            </div>
          </div>

          <!-- What to Expect Card -->
          <div class="card">
            <h3 class="heading-card mb-6">What to Expect</h3>
            <div class="space-y-4">
              <div class="flex gap-3">
                <div class="flex-shrink-0">
                  <div class="flex items-center justify-center h-8 w-8 rounded-full bg-amber-500/20 border border-amber-500">
                    <span class="text-amber-500 font-bold text-sm">1</span>
                  </div>
                </div>
                <div>
                  <p class="text-white font-medium text-sm">Submit your project details</p>
                </div>
              </div>
              <div class="flex gap-3">
                <div class="flex-shrink-0">
                  <div class="flex items-center justify-center h-8 w-8 rounded-full bg-amber-500/20 border border-amber-500">
                    <span class="text-amber-500 font-bold text-sm">2</span>
                  </div>
                </div>
                <div>
                  <p class="text-white font-medium text-sm">We'll review and follow up within 24 hours</p>
                </div>
              </div>
              <div class="flex gap-3">
                <div class="flex-shrink-0">
                  <div class="flex items-center justify-center h-8 w-8 rounded-full bg-amber-500/20 border border-amber-500">
                    <span class="text-amber-500 font-bold text-sm">3</span>
                  </div>
                </div>
                <div>
                  <p class="text-white font-medium text-sm">Schedule a site assessment or flight plan</p>
                </div>
              </div>
              <div class="flex gap-3">
                <div class="flex-shrink-0">
                  <div class="flex items-center justify-center h-8 w-8 rounded-full bg-amber-500/20 border border-amber-500">
                    <span class="text-amber-500 font-bold text-sm">4</span>
                  </div>
                </div>
                <div>
                  <p class="text-white font-medium text-sm">Receive your deliverables</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Trust Badges Card -->
          <div class="card">
            <h3 class="heading-card mb-6">Why Trust Us</h3>
            <div class="space-y-3">
              <div class="flex items-center gap-3 pb-3 border-b border-zinc-800">
                <div class="w-2 h-2 bg-amber-500 rounded-full flex-shrink-0"></div>
                <span class="text-white text-sm">FAA Part 107 Licensed</span>
              </div>
              <div class="flex items-center gap-3 pb-3 border-b border-zinc-800">
                <div class="w-2 h-2 bg-amber-500 rounded-full flex-shrink-0"></div>
                <span class="text-white text-sm">Fully Insured</span>
              </div>
              <div class="flex items-center gap-3">
                <div class="w-2 h-2 bg-amber-500 rounded-full flex-shrink-0"></div>
                <span class="text-white text-sm">RTK-Enabled Systems</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- FAQ Section -->
  <section class="py-20 border-t border-zinc-800">
    <div class="section-container">
      <div class="max-w-3xl mx-auto">
        <h2 class="heading-section text-center mb-12">Common Questions</h2>

        <div class="space-y-0 border border-zinc-800">
          <!-- FAQ Item 1 -->
          <details class="group border-b border-zinc-800 last:border-b-0">
            <summary class="flex items-center justify-between cursor-pointer py-4 px-6 hover:bg-zinc-900/50 transition-colors select-none">
              <span class="text-white font-medium group-open:text-amber-500 transition-colors">What areas do you serve?</span>
              <span class="text-amber-500 text-xl group-open:rotate-180 transition-transform">›</span>
            </summary>
            <div class="px-6 pb-4 text-zinc-300">
              <p>Southern California and surrounding regions. We can travel for larger projects and have completed work across the western United States.</p>
            </div>
          </details>

          <!-- FAQ Item 2 -->
          <details class="group border-b border-zinc-800 last:border-b-0">
            <summary class="flex items-center justify-between cursor-pointer py-4 px-6 hover:bg-zinc-900/50 transition-colors select-none">
              <span class="text-white font-medium group-open:text-amber-500 transition-colors">How accurate is the data?</span>
              <span class="text-amber-500 text-xl group-open:rotate-180 transition-transform">›</span>
            </summary>
            <div class="px-6 pb-4 text-zinc-300">
              <p>Our RTK-enabled drones achieve ±2cm horizontal accuracy without ground control points. For surveying-grade requirements, we can implement ground control points for even higher precision.</p>
            </div>
          </details>

          <!-- FAQ Item 3 -->
          <details class="group border-b border-zinc-800 last:border-b-0">
            <summary class="flex items-center justify-between cursor-pointer py-4 px-6 hover:bg-zinc-900/50 transition-colors select-none">
              <span class="text-white font-medium group-open:text-amber-500 transition-colors">How long does processing take?</span>
              <span class="text-amber-500 text-xl group-open:rotate-180 transition-transform">›</span>
            </summary>
            <div class="px-6 pb-4 text-zinc-300">
              <p>Most deliverables are ready within 3-5 business days. Rush delivery is available for expedited projects with additional fees.</p>
            </div>
          </details>

          <!-- FAQ Item 4 -->
          <details class="group border-b border-zinc-800 last:border-b-0">
            <summary class="flex items-center justify-between cursor-pointer py-4 px-6 hover:bg-zinc-900/50 transition-colors select-none">
              <span class="text-white font-medium group-open:text-amber-500 transition-colors">What file formats do you deliver?</span>
              <span class="text-amber-500 text-xl group-open:rotate-180 transition-transform">›</span>
            </summary>
            <div class="px-6 pb-4 text-zinc-300">
              <p>GeoTIFF, LAS/LAZ, OBJ, PDF, DXF, and more. We work with your existing workflow and deliver in the formats you need.</p>
            </div>
          </details>

          <!-- FAQ Item 5 -->
          <details class="group">
            <summary class="flex items-center justify-between cursor-pointer py-4 px-6 hover:bg-zinc-900/50 transition-colors select-none">
              <span class="text-white font-medium group-open:text-amber-500 transition-colors">Do I need to be on-site during the flight?</span>
              <span class="text-amber-500 text-xl group-open:rotate-180 transition-transform">›</span>
            </summary>
            <div class="px-6 pb-4 text-zinc-300">
              <p>Not necessarily. We coordinate access and can fly independently with proper authorization. However, we recommend being available for site walkthrough and project planning.</p>
            </div>
          </details>
        </div>
      </div>
    </div>
  </section>
</Layout>

<script>
  // HubSpot Form Integration
  const contactForm = document.getElementById('contactForm');
  const submitBtn = document.getElementById('submitBtn');
  const successMessage = document.getElementById('successMessage');
  const errorMessage = document.getElementById('errorMessage');

  contactForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    // Validate required fields
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const location = document.getElementById('location').value.trim();
    const timeline = document.getElementById('timeline').value.trim();

    if (!name || !email || !location || !timeline) {
      alert('Please fill in all required fields.');
      return;
    }

    // Show loading state
    submitBtn.disabled = true;
    submitBtn.textContent = 'Submitting...';
    errorMessage.classList.add('hidden');
    successMessage.classList.add('hidden');

    // Get HubSpot credentials from data attributes
    const portalId = contactForm.getAttribute('data-portal-id');
    const formGuid = contactForm.getAttribute('data-form-guid');

    // Check if placeholder values are still in use
    if (portalId === 'YOUR_PORTAL_ID' || formGuid === 'YOUR_FORM_GUID') {
      console.warn('HubSpot credentials not configured. Using mailto fallback.');
      submitViaMailto();
      return;
    }

    // Split name into first and last
    const nameParts = name.split(' ');
    const firstName = nameParts[0];
    const lastName = nameParts.slice(1).join(' ') || '';

    // Prepare form data for HubSpot
    const formData = {
      fields: [
        { name: 'firstname', value: firstName },
        { name: 'lastname', value: lastName },
        { name: 'email', value: email },
        { name: 'phone', value: document.getElementById('phone').value.trim() || '' },
        { name: 'company', value: document.getElementById('company').value.trim() || '' },
        { name: 'hs_lead_status', value: document.getElementById('projectType').value || '' },
        { name: 'message', value: document.getElementById('details').value.trim() || '' },
      ],
      context: {
        pageUri: window.location.href,
        pageName: 'Contact Page',
      },
    };

    try {
      // Submit to HubSpot API
      const response = await fetch(
        `https://api.hsforms.com/submissions/v3/integration/submit/${portalId}/${formGuid}`,
        {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData),
        }
      );

      if (response.ok) {
        // Success
        contactForm.classList.add('hidden');
        successMessage.classList.remove('hidden');
        submitBtn.disabled = false;
        submitBtn.textContent = 'Submit Request';
      } else {
        // HubSpot error, show error and fallback
        throw new Error(`HubSpot API returned ${response.status}`);
      }
    } catch (error) {
      console.error('HubSpot submission error:', error);
      // Show error message with fallback option
      errorMessage.classList.remove('hidden');
      submitBtn.disabled = false;
      submitBtn.textContent = 'Submit Request';
    }
  });

  // Fallback: Submit via mailto
  function submitViaMailto() {
    const name = document.getElementById('name').value.trim();
    const email = document.getElementById('email').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const company = document.getElementById('company').value.trim();
    const projectType = document.getElementById('projectType').value;
    const location = document.getElementById('location').value.trim();
    const timeline = document.getElementById('timeline').value;
    const budget = document.getElementById('budget').value;
    const details = document.getElementById('details').value.trim();

    const subject = encodeURIComponent(`New Project Inquiry from ${name}`);
    const body = encodeURIComponent(
      `Name: ${name}\nEmail: ${email}\nPhone: ${phone}\nCompany: ${company}\nProject Type: ${projectType}\nLocation: ${location}\nTimeline: ${timeline}\nBudget: ${budget}\n\nProject Details:\n${details}`
    );

    window.location.href = `mailto:contact@vantagepoint.com?subject=${subject}&body=${body}`;

    // Show success message
    contactForm.classList.add('hidden');
    successMessage.classList.remove('hidden');
    submitBtn.disabled = false;
    submitBtn.textContent = 'Submit Request';
  }
</script>
